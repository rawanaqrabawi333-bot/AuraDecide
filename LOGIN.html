	<!DOCTYPE html>
	<html lang="ar">
	<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>تسجيل الدخول / إنشاء حساب</title>
	<style>
		body {
		  font-family: "Cairo", sans-serif;
		  background-color: #f7efdf;
		  margin: 0;
		  padding: 0;
		}

		.container {
			background: #fff;
			padding: 40px;
			border-radius: 20px;
			box-shadow: 0 0 20px rgba(0,0,0,0.2);
			width: 420px;
			text-align: center;
		}

		h2 {
			margin-bottom: 25px;
		}

		input {
			width: 90%;
			padding: 15px;
			margin: 10px 0;
			border: 1px solid #aaa;
			border-radius: 10px;
			font-size: 16px;
		}

		button {
			width: 95%;
			padding: 15px;
			background-color: #000;
			color: #fff;
			border: none;
			border-radius: 10px;
			cursor: pointer;
			margin-top: 15px;
			font-size: 18px;
		}

		button:hover {
			background-color: #333;
		}

		.link {
			color: #000;
			text-decoration: underline;
			cursor: pointer;
			font-size: 16px;
			margin-top: 10px;
			display: block;
		}

		#signupForm { display: none; }

		#message, #loginMessage {
			color: red;
			font-size: 16px;
			margin-top: 10px;
			min-height: 22px;
		}

		#forgotPopup {
			display: none;
			position: fixed;
			top: 0; left: 0;
			width: 100%; height: 100%;
			background-color: rgba(0,0,0,0.5);
			justify-content: center;
			align-items: center;
		}

		.popup-content {
			background: #fff;
			padding: 30px;
			border-radius: 15px;
			width: 350px;
			text-align: center;
		}

		.close {
		  color: red;
		  cursor: pointer;
		  font-weight: bold;
		  float: right;
		}
		header {
		  display: flex;
		  justify-content: space-between;
		  align-items: center;
		  padding: 8px 40px;   /* ← صغّرت الارتفاع ليصير نفس الصورة */
		  background-color: #f7efdf;

		}
		.nav-links {
		  display: flex;
		  align-items: center;
		  gap: 30px;
		}

		.nav-links a {
		  text-decoration: none;
		  color: #000;
		  font-weight: 700;
		  text-transform: uppercase;
		  font-size: 13px;    /* ← صغير مثل الصورة */
		  letter-spacing: 1px;
		}



		.contact-btn {
		  display: inline-block;   /* أهم شي */
		  width: auto;             /* يخلي حجم الزر على قد الكلمة */
		  background-color: #d8c7a4;
		  border: none;
		  padding: 6px 18px;
		  border-radius: 25px;
		  cursor: pointer;
		  font-weight: 600;
		  text-transform: uppercase;
		  font-size: 12px;
		}


		.page-content {
		  display: flex;
		  justify-content: center;
		  align-items: center;
		  padding: 60px 0;
		}


	</style>
	</head>
	<body>

	<header>
		<div class="nav-links">
		  <a href="index.html">Home</a>
		  <a href="services.html">Services</a>
		  <a href="LOGIN.html">Login</a>
		  <a href="Analysis.html">AI Analysis</a>
		  <a href="result.html">Insight</a>
		</div>
		
		<button id="logoutBtn" class="contact-btn" style="display:none;">Logout</button>

	</header>
	<div class="page-content">
		<div class="container">

			<h2 id="formTitle">تسجيل الدخول</h2>

	  <!-- تسجيل الدخول -->
		  <div id="loginForm">
			<input type="text" placeholder="البريد الإلكتروني أو رقم الهاتف" id="loginUser"><br>
			<input type="password" placeholder="كلمة المرور" id="loginPass"><br>
			<p id="loginMessage"></p>
			<button onclick="validateLogin()">تسجيل الدخول</button>
			<p class="link" onclick="showSignup()">إنشاء حساب جديد</p>
			<p class="link" onclick="showForgot()">نسيت كلمة المرور؟</p>
		  </div>

	  <!-- إنشاء حساب -->
		  <div id="signupForm">
			<input type="text" placeholder="الاسم الأول" id="fname"><br>
			<input type="text" placeholder="الاسم الأخير" id="lname"><br>
			<input type="text" placeholder="البريد الإلكتروني أو رقم الهاتف" id="contact"><br>
			<input type="password" placeholder="إنشاء كلمة مرور" id="password"><br>
			<input type="password" placeholder="تأكيد كلمة المرور" id="confirmPassword"><br>
			<p id="message"></p>
			<button onclick="validateSignup()">إنشاء الحساب</button>
			<p class="link" onclick="showLogin()">الرجوع إلى تسجيل الدخول</p>
		  </div>
		 </div>
	</div>

	<!-- نسيت كلمة المرور -->
	<div id="forgotPopup">
	  <div class="popup-content">
		<span class="close" onclick="closeForgot()">&times;</span>
		<h3>استعادة كلمة المرور</h3>
		<p>أدخل البريد الإلكتروني أو رقم الهاتف:</p>
		<input type="text" placeholder="البريد الإلكتروني أو رقم الهاتف" id="recoverInput"><br>
		<button onclick="sendRecovery()">إرسال</button>
		<p id="recoverMsg"></p>
	  </div>
	</div>

<script type="module">

/* ------------------------------------
   Firebase Imports
-------------------------------------*/
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword,
  sendPasswordResetEmail,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { 
  getFirestore, 
  setDoc, 
  doc 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


/* ------------------------------------
   Firebase Config
-------------------------------------*/
const firebaseConfig = {
  apiKey: "AIzaSyClQwi-qkw0gm-h4W-1Ml_GmVurHmoLNxM",
  authDomain: "nabd-project.firebaseapp.com",
  projectId: "nabd-project",
  storageBucket: "nabd-project.firebasestorage.app",
  messagingSenderId: "684621374858",
  appId: "1:684621374858:web:45803c0ac4df49cacb5473",
  measurementId: "G-929SFBC8J2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);


/* ------------------------------------
   حماية الصفحة (منع الدخول بدون تسجيل دخول)
-------------------------------------*/
onAuthStateChanged(auth, (user) => {
  const logoutBtn = document.getElementById("logoutBtn");
  const loginLink = document.querySelector('a[href="LOGIN.html"]');

  if (user) {
    if (logoutBtn) logoutBtn.style.display = "inline-block";
    if (loginLink) loginLink.style.display = "none";
  } else {
    if (logoutBtn) logoutBtn.style.display = "none";
    if (loginLink) loginLink.style.display = "inline-block";
    // ❌ بدون أي تحويل هنا
  }
});



/* ------------------------------------
   UI Controls
-------------------------------------*/
window.showSignup = function () {
  document.getElementById('loginForm').style.display = 'none';
  document.getElementById('signupForm').style.display = 'block';
  document.getElementById('formTitle').innerText = 'إنشاء حساب';
};

window.showLogin = function () {
  document.getElementById('signupForm').style.display = 'none';
  document.getElementById('loginForm').style.display = 'block';
  document.getElementById('formTitle').innerText = 'تسجيل الدخول';
};

function isValidEmail(value) {
  return value.includes("@");
}


/* ------------------------------------
   إنشاء حساب
-------------------------------------*/
window.validateSignup = async function () {

  let fname = document.getElementById("fname").value.trim();
  let lname = document.getElementById("lname").value.trim();
  let email = document.getElementById("contact").value.trim();
  let pass = document.getElementById("password").value.trim();
  let confirm = document.getElementById("confirmPassword").value.trim();
  let msg = document.getElementById("message");

  if (!fname) return msg.textContent = "⚠️ الرجاء إدخال الاسم الأول";
  if (!lname) return msg.textContent = "⚠️ الرجاء إدخال الاسم الأخير";
  if (!email) return msg.textContent = "⚠️ الرجاء إدخال البريد الإلكتروني";
  if (!isValidEmail(email)) return msg.textContent = "⚠️ البريد الإلكتروني غير صالح";
  if (!pass) return msg.textContent = "⚠️ الرجاء إدخال كلمة المرور";
  if (pass !== confirm) return msg.textContent = "⚠️ كلمة المرور غير متطابقة";

  try {
    // إنشاء المستخدم في Firebase
    const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
    const user = userCredential.user;

    // حفظ بياناته في Firestore
    await setDoc(doc(db, "users", user.uid), {
      firstName: fname,
      lastName: lname,
      email: email
    });

    msg.style.color = "green";
    msg.textContent = "✔️ تم إنشاء الحساب بنجاح";

    setTimeout(() => showLogin(), 1500);

  } catch (error) {
    msg.style.color = "red";
    msg.textContent = error.message;
  }
};


/* ------------------------------------
   تسجيل الدخول
-------------------------------------*/
window.validateLogin = async function () {

  let email = document.getElementById("loginUser").value.trim();
  let pass = document.getElementById("loginPass").value.trim();
  let msg = document.getElementById("loginMessage");

  if (!email) return msg.textContent = "⚠️ أدخل البريد الإلكتروني";
  if (!isValidEmail(email)) return msg.textContent = "⚠️ البريد الإلكتروني غير صالح";
  if (!pass) return msg.textContent = "⚠️ أدخل كلمة المرور";

  try {
    await signInWithEmailAndPassword(auth, email, pass);

    msg.style.color = "green";
    msg.textContent = "✔️ تم تسجيل الدخول";

    setTimeout(() => {

	  // هل يوجد صفحة لازم يرجع عليها؟
	  let redirectPage = localStorage.getItem("redirectAfterLogin");
	
	  if (redirectPage) {
	      localStorage.removeItem("redirectAfterLogin");
	      window.location.href = redirectPage;  // ← يرجع لـ Analysis
	  } else {
	      window.location.href = "index.html"; // ← يدخل طبيعي
	  }
	
	}, 1000);


  } catch (error) {
    msg.style.color = "red";
    msg.textContent = error.message;
  }
};


/* ------------------------------------
   نسيت كلمة المرور
-------------------------------------*/
window.showForgot = function () {
  document.getElementById("forgotPopup").style.display = "flex";
};

window.closeForgot = function () {
  document.getElementById("forgotPopup").style.display = "none";
};

window.sendRecovery = async function () {
  let email = document.getElementById("recoverInput").value.trim();
  let msg = document.getElementById("recoverMsg");

  if (!email) return msg.textContent = "⚠️ أدخل البريد الإلكتروني";
  if (!isValidEmail(email)) return msg.textContent = "⚠️ البريد الإلكتروني غير صالح";

  try {
    await sendPasswordResetEmail(auth, email);
    msg.style.color = "green";
    msg.textContent = "✔️ تم إرسال رابط الاسترجاع";

  } catch (error) {
    msg.style.color = "red";
    msg.textContent = error.message;
  }
};


/* ------------------------------------
   تسجيل الخروج
-------------------------------------*/
const logoutBtn = document.getElementById("logoutBtn");

if (logoutBtn) {
  logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "LOGIN.html";
  });
}

</script>



</body>
</html>




